name: update registrar RDAP data

on:
  push:
    paths:
      - 'rarrdap.pl'
      - '.github/workflows/build.yml'
    branches: [ "main" ]
  workflow_dispatch:
  schedule:
    - cron: '32 4 * * *'

jobs:
  build:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3

      - name: install cpanm
        run: |
          sudo apt-get update
          sudo apt-get -qqq install cpanminus

      - name: install Perl modules
        run: cpanm --sudo --notest DateTime JSON LWP::Protocol::https Text::CSV_XS

      - name: create output directory
        run: mkdir ./data

      - name: generate data
        run: ./rarrdap.pl ./data

      - uses: actions/upload-artifact@v3
        with:
          name: registrar-rdap-data
          path: ./data
